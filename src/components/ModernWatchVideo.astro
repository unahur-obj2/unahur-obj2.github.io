---
// Componente moderno para videos con colores UNAHUR
export interface Props {
	title: string
	urlYoutube: string
}

const { title, urlYoutube } = Astro.props

function getIframeUrl(youtubeUrl: string): string | null {
	if (!youtubeUrl || typeof youtubeUrl !== 'string') {
		return null
	}

	const match = youtubeUrl.match(
		/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/)([a-zA-Z0-9-_]{11})/
	)
	if (match && match[1]) {
		return `https://www.youtube.com/embed/${match[1]}`
	}
	return null
}

// Iconos SVG
const playIcon = `<svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m6-6L21 3m0 0h-5m5 0v5M7.05 7.05L3 3m0 0h5M3 3v5"/></svg>`
const youtubeIcon = `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>`
const linkIcon = `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>`

const iframeUrl = getIframeUrl(urlYoutube)
---

<div class="mx-auto my-12 w-full max-w-4xl px-4">
	<div
		class="overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-xl dark:border-gray-700 dark:bg-gray-800">
		<!-- Header -->
		<div class="bg-gradient-to-r from-unahur-primary to-unahur-secondary p-6">
			<div class="flex items-center gap-3">
				<div class="rounded-lg bg-white/20 p-2">
					<span
						set:html={playIcon}
						class="text-white"
					/>
				</div>
				<h3 class="text-xl font-bold text-white">{title}</h3>
			</div>
		</div>

		<!-- Video Container -->
		<div class="p-6">
			<div
				class="relative overflow-hidden rounded-xl bg-gray-100 shadow-lg dark:bg-gray-700">
				{
					iframeUrl ? (
						<iframe
							class="aspect-video w-full"
							src={iframeUrl}
							title={`Video: ${title}`}
							frameborder="0"
							allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
							referrerpolicy="strict-origin-when-cross-origin"
							allowfullscreen
						/>
					) : (
						<div class="flex aspect-video w-full items-center justify-center bg-gray-200 dark:bg-gray-600">
							<div class="text-center">
								<span
									set:html={playIcon}
									class="mx-auto mb-2 text-gray-400"
								/>
								<p class="text-gray-500 dark:text-gray-400">
									Video no disponible
								</p>
							</div>
						</div>
					)
				}
			</div>

			<!-- Footer con enlace alternativo -->
			<div
				class="mt-6 rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-gray-600 dark:bg-gray-700/50">
				<div class="flex flex-wrap items-center justify-between gap-4">
					<p class="text-sm text-gray-600 dark:text-gray-300">
						¿Problemas con la reproducción?
					</p>
					<a
						href={urlYoutube}
						target="_blank"
						rel="noopener noreferrer"
						class="inline-flex items-center gap-2 rounded-lg bg-red-600 px-4 py-2 text-sm font-medium text-white transition-all duration-200 hover:scale-105 hover:bg-red-700">
						<span set:html={youtubeIcon} />
						Ver en YouTube
						<span set:html={linkIcon} />
					</a>
				</div>
			</div>
		</div>
	</div>
</div>
